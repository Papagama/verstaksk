<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            padding: 40px; 
            background: #f5f5f5; 
        }
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: white; 
            padding: 40px; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { 
            color: #FF4D00; 
            margin-bottom: 10px; 
            font-size: 2rem;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        .status {
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-weight: 600;
        }
        .status.loading {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .image-card {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            border: 2px solid #e0e0e0;
        }
        .image-card.success {
            border-color: #28a745;
        }
        .image-card.error {
            border-color: #dc3545;
            background: #fff5f5;
        }
        .image-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 10px;
            background: #ddd;
        }
        .image-info {
            font-size: 0.85rem;
            color: #666;
        }
        .image-info strong {
            color: #333;
            display: block;
            margin-bottom: 5px;
        }
        .image-status {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .image-status.ok {
            background: #d4edda;
            color: #155724;
        }
        .image-status.fail {
            background: #f8d7da;
            color: #721c24;
        }
        .storage-info {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }
        .storage-info h3 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        .storage-bar {
            width: 100%;
            height: 20px;
            background: #ddd;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .storage-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            transition: width 0.3s;
        }
        .storage-bar-fill.warning {
            background: linear-gradient(90deg, #ff9800, #ffc107);
        }
        .storage-bar-fill.danger {
            background: linear-gradient(90deg, #f44336, #e91e63);
        }
        .btn {
            background: #FF4D00;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
            transition: 0.3s;
        }
        .btn:hover {
            background: #e64400;
        }
        .btn.danger {
            background: #dc3545;
        }
        .btn.danger:hover {
            background: #c82333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</h1>
        <p class="subtitle">
            –≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ –≤–∞—à–µ–º —Å–∞–π—Ç–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ LocalStorage.
        </p>

        <div id="storage-info" class="storage-info">
            <h3>üìä LocalStorage</h3>
            <div id="storage-details">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <div class="storage-bar">
                <div id="storage-bar" class="storage-bar-fill" style="width: 0%"></div>
            </div>
            <button class="btn" onclick="showStorageDetails()">üìã –î–µ—Ç–∞–ª–∏ —Ä–∞–±–æ—Ç</button>
            <button class="btn danger" onclick="clearStorage()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å LocalStorage</button>
        </div>

        <div id="status" class="status loading">
            ‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π...
        </div>

        <div id="results" class="result-grid"></div>
    </div>

    <script>
        const imagesToCheck = [
            { path: 'images/hero-photo.png', name: 'Hero —Ñ–æ—Ç–æ', required: true },
            { path: 'images/about-photo.jpg', name: 'About —Ñ–æ—Ç–æ', required: true },
            { path: 'images/work-architecture.jpg', name: 'Architecture –ø—Ä–æ–µ–∫—Ç', required: true },
            { path: 'images/work-iphone.jpg', name: 'iPhone –ø—Ä–æ–µ–∫—Ç', required: true },
            { path: 'images/work-furniture.png', name: 'Furniture –ø—Ä–æ–µ–∫—Ç', required: true },
            { path: 'images/work-textile.jpg', name: 'Textile –ø—Ä–æ–µ–∫—Ç', required: true },
            { path: 'favicon.svg', name: 'Favicon', required: false }
        ];

        async function checkStorage() {
            let total = 0;
            for (let key in localStorage) {
                if (localStorage.hasOwnProperty(key)) {
                    total += localStorage[key].length + key.length;
                }
            }
            
            const totalMB = (total / 1024 / 1024).toFixed(2);
            const limitMB = 5; // –ü—Ä–∏–º–µ—Ä–Ω—ã–π –ª–∏–º–∏—Ç
            const percentage = Math.min((total / (limitMB * 1024 * 1024)) * 100, 100).toFixed(0);
            
            const bar = document.getElementById('storage-bar');
            bar.style.width = percentage + '%';
            
            if (percentage > 80) {
                bar.classList.add('danger');
            } else if (percentage > 60) {
                bar.classList.add('warning');
            }

            const works = JSON.parse(localStorage.getItem('portfolio_works') || '[]');
            
            document.getElementById('storage-details').innerHTML = `
                <strong>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${totalMB} MB / ~${limitMB} MB (${percentage}%)</strong><br>
                –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ —Ä–∞–±–æ—Ç: ${works.length}<br>
                ${percentage > 80 ? '<span style="color: #d32f2f;">‚ö†Ô∏è –ü–æ—á—Ç–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ! –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—á–∏—Å—Ç–∫–∞.</span>' : ''}
                ${percentage > 90 ? '<br><span style="color: #d32f2f; font-weight: bold;">‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ò –ú–ê–õ–û –ú–ï–°–¢–ê!</span>' : ''}
            `;
        }

        function showStorageDetails() {
            const works = JSON.parse(localStorage.getItem('portfolio_works') || '[]');
            if (works.length === 0) {
                alert('–í LocalStorage –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç.');
                return;
            }

            let details = '–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã:\n\n';
            works.forEach((work, i) => {
                const sizeMB = (work.image?.length / 1024 / 1024).toFixed(2) || '0';
                details += `${i + 1}. ${work.title} - ${sizeMB} MB\n`;
            });
            
            alert(details);
        }

        function clearStorage() {
            if (!confirm('‚ö†Ô∏è –í—ã —É–≤–µ—Ä–µ–Ω—ã?\n\n–≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã –∏–∑ admin-–ø–∞–Ω–µ–ª–∏.\n–û—Ç–º–µ–Ω–∏—Ç—å —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –±—É–¥–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ!')) {
                return;
            }
            
            const secondConfirm = confirm('–ü–æ—Å–ª–µ–¥–Ω–µ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ!\n\n–í—Å–µ —Ä–∞–±–æ—Ç—ã –±—É–¥—É—Ç –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ —É–¥–∞–ª–µ–Ω—ã. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?');
            if (!secondConfirm) {
                return;
            }

            localStorage.removeItem('portfolio_works');
            alert('‚úÖ LocalStorage –æ—á–∏—â–µ–Ω!');
            checkStorage();
        }

        async function checkImage(imageInfo) {
            return new Promise((resolve) => {
                const img = new Image();
                const startTime = Date.now();
                
                img.onload = () => {
                    const loadTime = Date.now() - startTime;
                    // –ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä (–Ω–µ —Ç–æ—á–Ω—ã–π, –Ω–æ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø–æ–¥–æ–π–¥—ë—Ç)
                    fetch(imageInfo.path)
                        .then(response => response.blob())
                        .then(blob => {
                            resolve({
                                ...imageInfo,
                                status: 'success',
                                width: img.naturalWidth,
                                height: img.naturalHeight,
                                size: (blob.size / 1024).toFixed(2),
                                loadTime: loadTime
                            });
                        })
                        .catch(() => {
                            resolve({
                                ...imageInfo,
                                status: 'success',
                                width: img.naturalWidth,
                                height: img.naturalHeight,
                                size: 'N/A',
                                loadTime: loadTime
                            });
                        });
                };

                img.onerror = () => {
                    resolve({
                        ...imageInfo,
                        status: 'error',
                        errorMsg: '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ'
                    });
                };

                img.src = imageInfo.path;
            });
        }

        function renderResult(result) {
            const card = document.createElement('div');
            card.className = `image-card ${result.status}`;
            
            if (result.status === 'success') {
                const sizeWarning = result.size !== 'N/A' && parseFloat(result.size) > 500 
                    ? '<br><span style="color: #ff9800;">‚ö†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è</span>' 
                    : '';
                
                card.innerHTML = `
                    <img src="${result.path}" alt="${result.name}">
                    <div class="image-info">
                        <strong>${result.name}</strong>
                        –†–∞–∑–º–µ—Ä: ${result.width}x${result.height}px<br>
                        –í–µ—Å: ${result.size} KB ${sizeWarning}<br>
                        –ó–∞–≥—Ä—É–∑–∫–∞: ${result.loadTime}ms
                    </div>
                    <div class="image-status ok">‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ</div>
                `;
            } else {
                card.innerHTML = `
                    <div class="image-info">
                        <strong>${result.name}</strong>
                        <span style="color: #dc3545;">‚ùå ${result.errorMsg}</span><br>
                        –ü—É—Ç—å: ${result.path}
                    </div>
                    <div class="image-status fail">
                        ‚ùå –û–®–ò–ë–ö–ê –ó–ê–ì–†–£–ó–ö–ò<br>
                        ${result.required ? '‚ö†Ô∏è –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ!' : '–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ'}
                    </div>
                `;
            }
            
            document.getElementById('results').appendChild(card);
        }

        async function runCheck() {
            const statusEl = document.getElementById('status');
            const resultsEl = document.getElementById('results');
            
            resultsEl.innerHTML = '';
            statusEl.className = 'status loading';
            statusEl.textContent = '‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π...';

            await checkStorage();

            const results = await Promise.all(imagesToCheck.map(img => checkImage(img)));
            
            const successCount = results.filter(r => r.status === 'success').length;
            const errorCount = results.filter(r => r.status === 'error').length;
            const requiredErrors = results.filter(r => r.status === 'error' && r.required).length;

            results.forEach(result => renderResult(result));

            if (requiredErrors > 0) {
                statusEl.className = 'status error';
                statusEl.innerHTML = `‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ${requiredErrors} –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!<br>
                                     <small>–≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏—á–∏–Ω–æ–π ERR_CONNECTION_RESET</small>`;
            } else if (errorCount > 0) {
                statusEl.className = 'status error';
                statusEl.textContent = `‚ö†Ô∏è –ù–∞–π–¥–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã: ${errorCount} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ)`;
            } else {
                statusEl.className = 'status success';
                statusEl.textContent = `‚úÖ –í—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ! (${successCount}/${imagesToCheck.length})`;
            }
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        runCheck();
    </script>
</body>
</html>
